;******************************************************************************
; *
; Filename: StoplightSetup.inc *
; Date: March 04, 2025 *
; Author: Andrew Keller *
; Company: Idaho State University *
; Description: Defines registers, bits, and constants. Configures SF registers *
; Github: https://github.com/andrew1593571/RCET3375.git *
; *
;******************************************************************************
  

;***********************************************
;DEFINE GENERAL FUNCTION REGISTERS
;***********************************************

INTCOUNT EQU H'0020'    ;KEEPS TRACK OF NUMBER OF TIMER INTERRUPTS
GRNCOUNT EQU H'0021'	;KEEPS TRACK OF GREEN LIGHT SECONDS


;***********************************************
;INITIALIZE PIC16F883 AND SETUP
;***********************************************

SETUP_CODE CODE	    ;START OF THE FILE
    
INITIALIZE:
    
;----------COUNT CONFIGURATION----------
    BANKSEL INTCOUNT
    MOVLW H'F0'
    MOVWF INTCOUNT	;SET THE STARTING INTCOUNT
    
    MOVLW H'05'
    MOVWF GRNCOUNT	;SET THE GREEN COUNT TO 5

;----------PORTA CONFIGURATION----------
    BANKSEL ANSEL
    MOVLW B'00000000'	;CONFIGURE PORTA ANALOG INPUTS
    MOVWF ANSEL
    
    BANKSEL TRISA
    MOVLW B'00000000'	;CONFIGURE PORTA TRISTATE BUFFER
    MOVWF TRISA
    
    BANKSEL PORTA
    CLRF PORTA		;CLEAR PORTA TO A KNOWN STATE
    
;----------PORTB CONFIGURATION----------
    BANKSEL ANSELH
    MOVLW B'00000000'	;CONFIGURE PORTB ANALOG INPUTS
    MOVWF ANSELH
    
    BANKSEL IOCB
    MOVLW B'00000011'	;CONFIGURE PORTB INTERRUPT ON CHANGE FOR EACH PIN
    MOVWF IOCB
    
    BANKSEL TRISB
    MOVLW B'00000011'	;CONFIGURE PORTB TRISTATE BUFFER
    MOVWF TRISB
    
    BANKSEL WPUB
    MOVLW B'00000000'	;CONFIGURE PORTB WEAK PULL UPS
    MOVWF WPUB
    
    BANKSEL PORTB
    CLRF PORTB		;CLEAR PORTB TO A KNOWN STATE

;----------PORTC CONFIGURATION----------
    BANKSEL TRISC
    MOVLW B'00000000'	;CONFIGURE PORTC TRISTATE BUFFER
    MOVWF TRISC
    
    BANKSEL PORTC
    MOVLW B'00100001'	;N/S GREEN, E/W RED
    MOVWF PORTC
    
;----------TIMER2 CONFIGURATION----------
    BANKSEL PR2
    MOVLW H'82'
    MOVWF PR2		;SET TIMER2 TO ROLLOVER AT 130
    
    BANKSEL T2CON
    MOVLW B'00111101'	;1:4 PRESCALE, 1:8 POSTSCALE, TIMER2 ENABLED
    MOVWF T2CON
    
;----------Interrupts CONFIGURATION----------
CONFIGINT:
    MOVLW B'01001000'	;UNMASK PERIPHERAL AND PORTB CHANGE INTERRUPTS
    MOVWF INTCON
    
    BANKSEL PIE1	;UNMASK THE TIMER2 INTERRUPT
    MOVLW B'00000010'
    MOVWF PIE1
    
    CLRF PIE2		;DISABLE ALL INTERRUPTS IN PIE2
    
    BSF INTCON, GIE	;ENABLE GLOBAL INTERRUPTS
    
    RETURN